services:
  openclaw:
    build:
      context: .
      dockerfile: Dockerfile
    image: openclaw:latest
    container_name: openclaw-gateway
    command: /bin/bash -c "node /app/substitute-env.js && node dist/index.js gateway"
    ports:
      - "18789:18789"
    environment:
      # Replace with your ngrok URL
      OLLAMA_BASE_URL: "https://85a10ae4dca6.ngrok-free.app/v1"
      WHATSAPP_PHONE: "+919618089879"
      GATEWAY_TOKEN: "4e8b5aa3cc3860cab2d0a2d898c8dacc6e583481d0b0ff6a"
      NODE_ENV: "production"
      HOME: "/home/node"
    volumes:
      # Mount config template and env script
      - ./openclaw.docker.json:/app/openclaw.docker.json:ro
      - ./substitute-env.js:/app/substitute-env.js:ro
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:18789" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
